{"ast":null,"code":"import _classCallCheck from\"C:\\\\Users\\\\user\\\\assisted-KAOS-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\user\\\\assisted-KAOS-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"C:\\\\Users\\\\user\\\\assisted-KAOS-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"C:\\\\Users\\\\user\\\\assisted-KAOS-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _inherits from\"C:\\\\Users\\\\user\\\\assisted-KAOS-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import React from'react';import{withStyles}from'@material-ui/core/styles';import AceEditor from'react-ace';import'brace/mode/dot';import'brace/theme/github';import IconButton from'@material-ui/core/IconButton';import ErrorOutline from'@material-ui/icons/ErrorOutline';var styles={errorButton:{position:'absolute',top:'calc(64px + 12px)'},aceSelectedWord:{position:'absolute',background:'rgb(250, 250, 255)',border:'1px solid rgb(200, 200, 250)'}};var TextEditor=/*#__PURE__*/function(_React$Component){_inherits(TextEditor,_React$Component);function TextEditor(props){var _this;_classCallCheck(this,TextEditor);_this=_possibleConstructorReturn(this,_getPrototypeOf(TextEditor).call(this,props));_this.handleChange=function(value,event){var hasUndo=_this.editor.getSession().getUndoManager().hasUndo();var hasRedo=_this.editor.getSession().getUndoManager().hasRedo();var undoRedoState={hasUndo:hasUndo,hasRedo:hasRedo};_this.props.onTextChange(value,undoRedoState);};_this.handleBeforeLoad=function(ace){_this.ace=ace;};_this.handleLoad=function(editor){_this.editor=editor;_this.props.registerUndo(_this.undo);_this.props.registerRedo(_this.redo);_this.props.registerUndoReset(_this.resetUndoStack);};_this.handleErrorButtonClick=function(event){_this.editor.scrollToLine(_this.props.error.line-1,true);};_this.undo=function(){_this.editor.getSession().getUndoManager().undo();};_this.redo=function(){_this.editor.getSession().getUndoManager().redo();};_this.resetUndoStack=function(){_this.editor.getSession().getUndoManager().reset();};_this.pendingChanges=0;return _this;}_createClass(TextEditor,[{key:\"render\",value:function render(){var _this2=this;var classes=this.props.classes;var annotations=null;if(this.props.error){annotations=[{row:this.props.error.line-1,column:0,text:this.props.error.message,type:\"error\",dummy:Date.now()// Workaround for issue #33\n}];if(this.editor&&!this.editor.isRowFullyVisible(this.props.error.line)){if(!this.prevError||this.props.error.message!==this.prevError.message||this.props.error.line!==this.prevError.line&&this.props.error.numLines-this.props.error.line!==this.prevNumLines-this.prevError.line){this.editor.scrollToLine(this.props.error.line-1,true);}}this.prevNumLines=this.props.error.numLines;}this.prevError=this.props.error;var locations=this.props.selectedGraphComponents.reduce(function(locations,component){return locations.concat(component.locations);},[]);var markers=locations.map(function(location){return{startRow:location.start.line-1,startCol:location.start.column-1,endRow:location.end.line-1,endCol:location.end.column-1,className:classes.aceSelectedWord,type:'background'};});// FIXME: There must be a better way...\nvar scrollbarWidth=0;if(this.div){var scrollbarDiv=this.div.querySelector('div.ace_scrollbar-v');var hasScrollbar=scrollbarDiv&&scrollbarDiv.style['display']!=='none';if(hasScrollbar){var scrollbarInnerDiv=scrollbarDiv.querySelector('div.ace_scrollbar-inner');scrollbarWidth=scrollbarInnerDiv.clientWidth-5;}}return React.createElement(\"div\",{id:\"text-editor-wrapper\",ref:function ref(div){return _this2.div=div;}},React.createElement(AceEditor// FIXME: Remove workaround when https://github.com/securingsincity/react-ace/issues/767 is fixed\n,{key:this.props.holdOff,mode:\"dot\",theme:\"github\",fontSize:this.props.fontSize+'px',tabSize:this.props.tabSize,onChange:this.handleChange,onBeforeLoad:this.handleBeforeLoad,onLoad:this.handleLoad,onFocus:this.props.onFocus,onBlur:this.props.onBlur,name:\"text-editor\",value:this.props.dotSrc// viewport height - app bar - 2 * padding\n,height:this.props.height,width:this.props.width,wrapEnabled:true,showPrintMargin:false,debounceChangePeriod:this.props.holdOff*1000,editorProps:{$blockScrolling:true},annotations:annotations,markers:markers}),React.createElement(IconButton,{id:\"error-button\",className:classes.errorButton,style:{left:\"calc(\".concat(this.props.width,\" - 2 * 12px - 12px - \").concat(scrollbarWidth,\"px\"),display:this.props.error?'block':'none',zIndex:1},color:\"inherit\",\"aria-label\":\"Error\",onClick:this.handleErrorButtonClick},React.createElement(ErrorOutline,{color:\"error\"})));}}]);return TextEditor;}(React.Component);export default withStyles(styles)(TextEditor);","map":{"version":3,"sources":["C:/Users/user/assisted-KAOS-editor/src/TextEditor.js"],"names":["React","withStyles","AceEditor","IconButton","ErrorOutline","styles","errorButton","position","top","aceSelectedWord","background","border","TextEditor","props","handleChange","value","event","hasUndo","editor","getSession","getUndoManager","hasRedo","undoRedoState","onTextChange","handleBeforeLoad","ace","handleLoad","registerUndo","undo","registerRedo","redo","registerUndoReset","resetUndoStack","handleErrorButtonClick","scrollToLine","error","line","reset","pendingChanges","classes","annotations","row","column","text","message","type","dummy","Date","now","isRowFullyVisible","prevError","numLines","prevNumLines","locations","selectedGraphComponents","reduce","component","concat","markers","map","location","startRow","start","startCol","endRow","end","endCol","className","scrollbarWidth","div","scrollbarDiv","querySelector","hasScrollbar","style","scrollbarInnerDiv","clientWidth","holdOff","fontSize","tabSize","onFocus","onBlur","dotSrc","height","width","$blockScrolling","left","display","zIndex","Component"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport { withStyles } from '@material-ui/core/styles';\r\nimport AceEditor from 'react-ace';\r\nimport 'brace/mode/dot';\r\nimport 'brace/theme/github';\r\nimport IconButton from '@material-ui/core/IconButton';\r\nimport ErrorOutline from '@material-ui/icons/ErrorOutline';\r\n\r\nconst styles = {\r\n  errorButton: {\r\n    position: 'absolute',\r\n    top: 'calc(64px + 12px)',\r\n  },\r\n  aceSelectedWord: {\r\n    position: 'absolute',\r\n    background: 'rgb(250, 250, 255)',\r\n    border: '1px solid rgb(200, 200, 250)',\r\n  },\r\n};\r\n\r\nclass TextEditor extends React.Component {\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.pendingChanges = 0;\r\n  }\r\n\r\n  handleChange = (value, event) => {\r\n    const hasUndo = this.editor.getSession().getUndoManager().hasUndo();\r\n    const hasRedo = this.editor.getSession().getUndoManager().hasRedo();\r\n    const undoRedoState = {hasUndo, hasRedo};\r\n    this.props.onTextChange(value, undoRedoState);\r\n  };\r\n\r\n  handleBeforeLoad = (ace) => {\r\n    this.ace = ace;\r\n  };\r\n\r\n  handleLoad = (editor) => {\r\n    this.editor = editor;\r\n    this.props.registerUndo(this.undo);\r\n    this.props.registerRedo(this.redo);\r\n    this.props.registerUndoReset(this.resetUndoStack);\r\n  };\r\n\r\n  handleErrorButtonClick = (event) => {\r\n    this.editor.scrollToLine(this.props.error.line - 1, true);\r\n  };\r\n\r\n  undo = () => {\r\n    this.editor.getSession().getUndoManager().undo();\r\n  }\r\n\r\n  redo = () => {\r\n    this.editor.getSession().getUndoManager().redo();\r\n  }\r\n\r\n  resetUndoStack = () => {\r\n    this.editor.getSession().getUndoManager().reset();\r\n  }\r\n\r\n  render() {\r\n    const { classes } = this.props;\r\n    var annotations = null;\r\n    if (this.props.error) {\r\n      annotations = [{\r\n        row: this.props.error.line - 1,\r\n        column: 0,\r\n        text: this.props.error.message,\r\n        type: \"error\",\r\n        dummy: Date.now(), // Workaround for issue #33\r\n      }];\r\n      if (this.editor && !this.editor.isRowFullyVisible(this.props.error.line)) {\r\n        if (!this.prevError ||\r\n            this.props.error.message !== this.prevError.message ||\r\n            (this.props.error.line !== this.prevError.line &&\r\n             this.props.error.numLines - this.props.error.line !== this.prevNumLines - this.prevError.line)\r\n           ) {\r\n          this.editor.scrollToLine(this.props.error.line - 1, true);\r\n        }\r\n      }\r\n      this.prevNumLines = this.props.error.numLines;\r\n    }\r\n    this.prevError = this.props.error;\r\n    const locations = this.props.selectedGraphComponents.reduce(\r\n      (locations, component) => locations.concat(\r\n        component.locations\r\n      ),\r\n      []\r\n    );\r\n    const markers = locations.map((location) => ({\r\n      startRow: location.start.line - 1,\r\n      startCol: location.start.column - 1,\r\n      endRow: location.end.line - 1,\r\n      endCol: location.end.column - 1,\r\n      className: classes.aceSelectedWord,\r\n      type: 'background',\r\n    }));\r\n    // FIXME: There must be a better way...\r\n    let scrollbarWidth = 0;\r\n    if (this.div) {\r\n      const scrollbarDiv = this.div.querySelector('div.ace_scrollbar-v');\r\n      const hasScrollbar = scrollbarDiv && scrollbarDiv.style['display'] !== 'none';\r\n      if (hasScrollbar) {\r\n        const scrollbarInnerDiv = scrollbarDiv.querySelector('div.ace_scrollbar-inner');\r\n        scrollbarWidth = scrollbarInnerDiv.clientWidth - 5;\r\n      }\r\n    }\r\n    return (\r\n      <div id=\"text-editor-wrapper\" ref={div => this.div = div}>\r\n        <AceEditor\r\n          // FIXME: Remove workaround when https://github.com/securingsincity/react-ace/issues/767 is fixed\r\n          key={this.props.holdOff}\r\n          mode=\"dot\"\r\n          theme=\"github\"\r\n          fontSize={this.props.fontSize + 'px'}\r\n          tabSize={this.props.tabSize}\r\n          onChange={this.handleChange}\r\n          onBeforeLoad={this.handleBeforeLoad}\r\n          onLoad={this.handleLoad}\r\n          onFocus={this.props.onFocus}\r\n          onBlur={this.props.onBlur}\r\n          name=\"text-editor\"\r\n          value={this.props.dotSrc}\r\n          // viewport height - app bar - 2 * padding\r\n          height={this.props.height}\r\n          width={this.props.width}\r\n          wrapEnabled\r\n          showPrintMargin={false}\r\n          debounceChangePeriod={this.props.holdOff * 1000}\r\n          editorProps={{\r\n            $blockScrolling: true\r\n          }}\r\n          annotations={annotations}\r\n          markers={markers}        />\r\n        <IconButton\r\n          id=\"error-button\"\r\n          className={classes.errorButton}\r\n          style={{\r\n            left: `calc(${this.props.width} - 2 * 12px - 12px - ${scrollbarWidth}px`,\r\n            display: this.props.error ? 'block' : 'none',\r\n            zIndex: 1,\r\n          }}\r\n          color=\"inherit\"\r\n          aria-label=\"Error\"\r\n          onClick={this.handleErrorButtonClick}\r\n        >\r\n          <ErrorOutline color=\"error\" />\r\n        </IconButton>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default withStyles(styles)(TextEditor);\r\n"]},"metadata":{},"sourceType":"module"}