{"ast":null,"code":"import _slicedToArray from\"C:\\\\Users\\\\user\\\\assisted-KAOS-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";import _classCallCheck from\"C:\\\\Users\\\\user\\\\assisted-KAOS-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/classCallCheck\";import _createClass from\"C:\\\\Users\\\\user\\\\assisted-KAOS-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"C:\\\\Users\\\\user\\\\assisted-KAOS-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"C:\\\\Users\\\\user\\\\assisted-KAOS-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/getPrototypeOf\";import _assertThisInitialized from\"C:\\\\Users\\\\user\\\\assisted-KAOS-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:\\\\Users\\\\user\\\\assisted-KAOS-editor\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/inherits\";import React from'react';import{withStyles}from'@material-ui/core/styles';import Fade from'@material-ui/core/Fade';import CircularProgress from'@material-ui/core/CircularProgress';import{select as d3_select}from'd3-selection';import{selectAll as d3_selectAll}from'd3-selection';import{transition as d3_transition}from'd3-transition';import{zoomIdentity as d3_zoomIdentity}from'd3-zoom';import{zoomTransform as d3_zoomTransform}from'd3-zoom';import{pointer as d3_pointer}from'd3-selection';import'd3-graphviz';import DotGraph from'./dot';import{wasmFolder}from\"@hpcc-js/wasm\";var styles={root:{flexGrow:1},flex:{flexGrow:1},progress:{position:'absolute',top:'calc(64px + 2 * 12px + 2px)',left:'calc(100vw - 2 * 12px - 2 * 12px)'}};function isNumeric(n){return!isNaN(parseFloat(n))&&isFinite(n);}var Graph=/*#__PURE__*/function(_React$Component){_inherits(Graph,_React$Component);function Graph(props){var _this;_classCallCheck(this,Graph);_this=_possibleConstructorReturn(this,_getPrototypeOf(Graph).call(this,props));_this.getSvg=function(){return _this.svg.node();};_this.handleZoomInButtonClick=function(){var scale=d3_zoomTransform(_this.graphviz.zoomSelection().node()).k;scale=scale*1.2;_this.setZoomScale(scale);};_this.handleZoomOutButtonClick=function(){var scale=d3_zoomTransform(_this.graphviz.zoomSelection().node()).k;scale=scale/1.2;_this.setZoomScale(scale);};_this.handleZoomOutMapButtonClick=function(){var viewBox=_this.svg.attr(\"viewBox\").split(' ');var bbox=_this.graph0.node().getBBox();var xRatio=viewBox[2]/bbox.width;var yRatio=viewBox[3]/bbox.height;var scale=Math.min(xRatio,yRatio);_this.setZoomScale(scale,true);};_this.handleZoomResetButtonClick=function(){_this.setZoomScale(1,true);};_this.setZoomScale=function(scale){var center=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var reset=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var viewBox=_this.svg.attr(\"viewBox\").split(' ');var bbox=_this.graph0.node().getBBox();var _d3_zoomTransform=d3_zoomTransform(_this.graphviz.zoomSelection().node()),x=_d3_zoomTransform.x,y=_d3_zoomTransform.y,k=_d3_zoomTransform.k;var x0=x,y0=y,scale0=k;var xOffset0=x0+bbox.x*scale0;var yOffset0=y0+bbox.y*scale0;var xCenter=viewBox[2]/2;var yCenter=viewBox[3]/2;var xOffset;var yOffset;if(center){xOffset=(viewBox[2]-bbox.width*scale)/2;yOffset=(viewBox[3]-bbox.height*scale)/2;}else if(reset){xOffset=0;yOffset=0;}else{xOffset=xCenter-(xCenter-xOffset0)*scale/scale0;yOffset=yCenter-(yCenter-yOffset0)*scale/scale0;}x=-bbox.x*scale+xOffset;y=-bbox.y*scale+yOffset;var transform=d3_zoomIdentity.translate(x,y).scale(scale);_this.graphviz.zoomSelection().call(_this.graphviz.zoomBehavior().transform,transform);};_this.handleNodeShapeClick=function(event,shape){if(shape==='(default)'){shape=null;}_this.props.onFocus();var x0=null;var y0=null;_this.latestInsertedNodeShape=shape;_this.insertNodeWithDefaultAttributes(x0,y0,{shape:shape});};_this.handleNodeShapeDragStart=function(event,shape){if(shape==='(default)'){shape=null;}var outsideOfViewPort=1000000;_this.latestInsertedNodeShape=shape;_this.drawNodeWithDefaultAttributes(outsideOfViewPort,outsideOfViewPort,{shape:shape});var node=_this.graphviz.drawnNodeSelection();if(!node.empty()&&!window.chrome){var bbox=node.node().getBBox();var scale=node.node().getCTM().a;node.attr(\"transform\",\"scale(\".concat(scale,\")\"));event.dataTransfer.setDragImage(node.node(),bbox.width/2*scale*4/3,bbox.height/2*scale*4/3);}event.dataTransfer.setData(\"text\",shape);};_this.handleNodeShapeDragOver=function(event){event.preventDefault();};_this.handleNodeShapeDrop=function(event){_this.props.onFocus();event.preventDefault();_this.graphviz.drawnNodeSelection().attr(\"transform\",null);var node=_this.graph0.node();var point=_this.svg.node().createSVGPoint();point.x=event.clientX;point.y=event.clientY;point=point.matrixTransform(node.getScreenCTM().inverse());var _ref=[point.x,point.y],x0=_ref[0],y0=_ref[1];_this.updateAndInsertDrawnNode(x0,y0,{});};_this.handleNodeShapeDragEnd=function(event,shape){_this.graphviz.removeDrawnNode();};_this.state={busy:false};_this.svg=d3_select(null);_this.createGraph=_this.createGraph.bind(_assertThisInitialized(_this));_this.renderGraph=_this.renderGraph.bind(_assertThisInitialized(_this));_this.isDrawingEdge=false;_this.isDrawingNode=false;_this.startNode=null;_this.selectedComponents=d3_selectAll(null);_this.selectArea=null;_this.selectRects=d3_select(null);_this.latestNodeAttributes={};_this.latestEdgeAttributes={};// latestInsertedNodeShape is not necessarily the same as\n// latestNodeAttributes.shape with is also set on node copy\n_this.latestInsertedNodeShape=null;_this.drawnNodeName=null;_this.nodeIndex=null;_this.edgeIndex=null;_this.pendingUpdate=false;_this.rendering=false;_this.prevFit=null;_this.prevEngine=null;_this.prevDotSrc='';return _this;}_createClass(Graph,[{key:\"componentDidMount\",value:function componentDidMount(){this.createGraph();}},{key:\"componentDidUpdate\",value:function componentDidUpdate(){this.renderGraph();}},{key:\"handleError\",value:function handleError(errorMessage){var line=errorMessage.replace(/.*error in line ([0-9]*) .*\\n/,'$1');this.props.onError({message:errorMessage,line:line});this.rendering=false;this.setState({busy:false});if(this.pendingUpdate){this.pendingUpdate=false;this.render();}}},{key:\"createGraph\",value:function createGraph(){var _this2=this;wasmFolder(process.env.PUBLIC_URL.replace(/\\.$/,'')+'@hpcc-js/wasm/dist');this.graphviz=this.div.graphviz().onerror(this.handleError.bind(this)).on('initEnd',function(){return _this2.renderGraph.call(_this2);});this.props.registerNodeShapeClick(this.handleNodeShapeClick);this.props.registerNodeShapeDragStart(this.handleNodeShapeDragStart);this.props.registerNodeShapeDragEnd(this.handleNodeShapeDragEnd);this.props.registerZoomInButtonClick(this.handleZoomInButtonClick);this.props.registerZoomOutButtonClick(this.handleZoomOutButtonClick);this.props.registerZoomOutMapButtonClick(this.handleZoomOutMapButtonClick);this.props.registerZoomResetButtonClick(this.handleZoomResetButtonClick);this.props.registerGetSvg(this.getSvg);}},{key:\"renderGraph\",value:function renderGraph(){var width=this.div.node().parentElement.clientWidth;var height=this.div.node().parentElement.clientHeight;var fit=this.props.fit;var engine=this.props.engine;if(this.props.dotSrc.length===0){this.svg.remove();this.svg=d3_select(null);this.props.onError(null);this.renderGraphReady=false;return;}if(this.props.dotSrc===this.prevDotSrc&&this.props.engine===this.prevEngine&&this.props.fit===this.prevFit){return;}if(this.rendering){this.pendingUpdate=true;return;}if(this.props.fit!==this.prevFit){if(this.renderGraphReady){if(this.prevFit){this.unFitGraph();this.setZoomScale(1,true);}else{this.setZoomScale(1,false,true);this.fitGraph();}}this.prevFit=this.props.fit;}this.prevDotSrc=this.props.dotSrc;this.prevEngine=this.props.engine;try{if(!this.props.test.disableDotParsing){this.prelDotGraph=new DotGraph(this.props.dotSrc);}this.props.onError(null);}catch(error){if(!error.location){throw error;}var line=error.location.start.line,message=error.message;this.props.onError({message:message,line:line});return;}this.rendering=true;this.setState({busy:true});this.graphviz.width(width).height(height).engine(engine).fit(fit).tweenPaths(this.props.tweenPaths).tweenShapes(this.props.tweenShapes).tweenPrecision(this.props.tweenPrecision).dot(this.props.dotSrc,this.handleDotLayoutReady.bind(this)).on('renderEnd',this.handleRenderStaged.bind(this)).render(this.handleRenderGraphReady.bind(this));}},{key:\"handleDotLayoutReady\",value:function handleDotLayoutReady(){var _this$graphviz$data$a=this.graphviz.data().attributes.viewBox.split(' '),_this$graphviz$data$a2=_slicedToArray(_this$graphviz$data$a,4),width=_this$graphviz$data$a2[2],height=_this$graphviz$data$a2[3];this.originalViewBox={width:width,height:height};}},{key:\"handleRenderStaged\",value:function handleRenderStaged(){if(this.renderGraphReady){this.markSelectedComponents(this.selectedComponents);}}},{key:\"handleRenderGraphReady\",value:function handleRenderGraphReady(){var _this3=this;this.svg=this.div.selectWithoutDataPropagation(\"svg\");this.graph0=this.svg.selectWithoutDataPropagation(\"g\");this.dotGraph=this.prelDotGraph;this.addEventHandlers();this.rendering=false;if(!this.renderGraphReady){this.renderGraphReady=true;this.setZoomScale(1,true);this.graphviz.transition(function(){return d3_transition().duration(_this3.props.transitionDuration*1000);});this.props.onInitialized();}this.setState({busy:false});if(this.pendingUpdate){this.pendingUpdate=false;this.renderGraph();}}},{key:\"addEventHandlers\",value:function addEventHandlers(){/*\r\n      Some empirical non-obvious and other relevant things to note:\r\n        1. Click events are preceeded by mousedown and mouseup events on the\r\n           same element.\r\n        2. 1st button clicks are click events on all elements.\r\n        3. 2nd and 3rd button clicks are click events on document and window\r\n           only, not on their children, although the event target is the child.\r\n        4. Keyboard events are dispatched on BODY, not on its children. This can\r\n           however be changed with the contenteditable attribute.\r\n    */var self=this;this.graphviz.zoomBehavior().filter(function(event){if(event.type==='mousedown'&&!event.ctrlKey){if(self.isDrawingEdge){return true;}else{return false;}}else{return true;}});var nodes=this.svg.selectAll(\".node\");var edges=this.svg.selectAll(\".edge\");d3_select(window).on(\"resize\",this.resizeSVG.bind(this));this.div.on(\"click\",this.handleClickDiv.bind(this));d3_select(document).on(\"keydown\",this.handleKeyDownDocument.bind(this));this.div.on(\"mousemove\",this.handleMouseMoveDiv.bind(this));this.div.on(\"contextmenu\",this.handleRightClickDiv.bind(this));this.svg.on(\"mousedown\",this.handleMouseDownSvg.bind(this));this.svg.on(\"mousemove\",this.handleMouseMoveSvg.bind(this));this.svg.on(\"click\",this.handleClickSvg.bind(this));this.svg.on(\"mouseup\",this.handleMouseUpSvg.bind(this));nodes.on(\"click mousedown\",this.handleClickNode.bind(this));nodes.on(\"dblclick\",this.handleDblClickNode.bind(this));nodes.on(\"contextmenu\",this.handleRightClickNode.bind(this));edges.on(\"click mousedown\",this.handleClickEdge.bind(this));}},{key:\"handleClickDiv\",value:function handleClickDiv(event){this.props.onFocus();document.activeElement.blur();event.preventDefault();event.stopPropagation();if(!(event.which===1&&(event.ctrlKey||event.shiftKey))){this.unSelectComponents();}}},{key:\"handleKeyDownDocument\",value:function handleKeyDownDocument(event){if(!this.props.hasFocus){return;}if(event.target.nodeName!=='BODY'){return;}if(event.key==='Escape'){this.graphviz.removeDrawnEdge();this.unSelectComponents();}else if(event.key==='Delete'){this.deleteSelectedComponents.call(this);this.graphviz.removeDrawnEdge();}else if(event.ctrlKey&&event.key==='c'){var nodes=this.selectedComponents.filter('.node');if(nodes.size()>0){var nodeName=nodes.selectWithoutDataPropagation(\"title\").text();this.latestNodeAttributes=this.dotGraph.getNodeAttributes(nodeName);}}else if(event.ctrlKey&&event.key==='v'){this.insertNodeWithLatestAttributes();}else if(event.ctrlKey&&event.key==='x'){var _nodes=this.selectedComponents.filter('.node');if(_nodes.size()>0){var _nodeName=_nodes.selectWithoutDataPropagation(\"title\").text();this.latestNodeAttributes=this.dotGraph.getNodeAttributes(_nodeName);}this.deleteSelectedComponents.call(this);}else if(event.ctrlKey&&event.key==='a'){this.selectAllComponents();}else if(event.ctrlKey&&event.key==='A'){var components=this.graph0.selectAll('.edge');this.selectComponents(components);}else if(event.ctrlKey&&event.key==='z'){this.props.onUndo();}else if(event.ctrlKey&&event.key==='y'){this.props.onRedo();}else if(event.key==='?'){this.props.onHelp();}else{return;}event.preventDefault();this.isDrawingEdge=false;}},{key:\"handleMouseMoveDiv\",value:function handleMouseMoveDiv(event){event.preventDefault();event.stopPropagation();var _d3_pointer=d3_pointer(event,this.graph0.node()),_d3_pointer2=_slicedToArray(_d3_pointer,2),x0=_d3_pointer2[0],y0=_d3_pointer2[1];var penwidth=1;if(this.latestEdgeAttributes.penwidth!=null){if(isNumeric(this.latestEdgeAttributes.penwidth)){penwidth=this.latestEdgeAttributes.penwidth;}}else if(this.latestEdgeAttributes.style&&this.latestEdgeAttributes.style.includes('bold')){penwidth=2;}var shortening=penwidth*2;// avoid mouse pointing on edge\nif(this.isDrawingEdge){this.graphviz.moveDrawnEdgeEndPoint(x0,y0,{shortening:shortening});}}},{key:\"handleClickNode\",value:function handleClickNode(event){this.props.onFocus();document.activeElement.blur();event.preventDefault();event.stopPropagation();if(!this.isDrawingEdge&&event.which===1){var extendSelection=event.ctrlKey||event.shiftKey;this.selectComponents(d3_select(event.currentTarget),extendSelection);}}},{key:\"handleDblClickNode\",value:function handleDblClickNode(event){this.props.onFocus();document.activeElement.blur();event.preventDefault();event.stopPropagation();this.unSelectComponents();if(this.isDrawingEdge){var endNode=d3_select(event.currentTarget);var startNodeName=this.startNode.selectWithoutDataPropagation(\"title\").text();var endNodeName=endNode.selectWithoutDataPropagation(\"title\").text();this.graphviz.insertDrawnEdge(startNodeName+'->'+endNodeName);this.latestEdgeAttributes=Object.assign({},this.props.defaultEdgeAttributes);this.dotGraph.insertEdge(startNodeName,endNodeName,this.latestEdgeAttributes);this.props.onTextChange(this.dotGraph.dotSrc);}this.isDrawingEdge=false;}},{key:\"handleRightClickNode\",value:function handleRightClickNode(event){this.props.onFocus();document.activeElement.blur();event.preventDefault();event.stopPropagation();this.unSelectComponents();this.graphviz.removeDrawnEdge();this.startNode=d3_select(event.currentTarget);var _d3_pointer3=d3_pointer(event,this.graph0.node()),_d3_pointer4=_slicedToArray(_d3_pointer3,2),x0=_d3_pointer4[0],y0=_d3_pointer4[1];if(this.edgeIndex===null){this.edgeIndex=d3_selectAll('.edge').size();}else{this.edgeIndex+=1;}this.latestEdgeAttributes=Object.assign({},this.props.defaultEdgeAttributes);this.latestEdgeAttributes.id='edge'+(this.edgeIndex+1);this.graphviz.drawEdge(x0,y0,x0,y0,this.latestEdgeAttributes);this.isDrawingEdge=true;}},{key:\"handleClickEdge\",value:function handleClickEdge(event){this.props.onFocus();document.activeElement.blur();event.preventDefault();event.stopPropagation();var extendSelection=event.ctrlKey||event.shiftKey;this.selectComponents(d3_select(event.currentTarget),extendSelection);}},{key:\"handleRightClickDiv\",value:function handleRightClickDiv(event){this.props.onFocus();document.activeElement.blur();event.preventDefault();event.stopPropagation();this.unSelectComponents();}},{key:\"handleMouseDownSvg\",value:function handleMouseDownSvg(event){this.props.onFocus();document.activeElement.blur();if(event.which!==1){return;}event.preventDefault();event.stopPropagation();if(this.selectArea){return;}var _d3_pointer5=d3_pointer(event,this.graph0.node()),_d3_pointer6=_slicedToArray(_d3_pointer5,2),x0=_d3_pointer6[0],y0=_d3_pointer6[1];this.selectArea={x0:x0,y0:y0};var offset=1;// avoid covering the svg at click in Chrome\nthis.selectArea.selection=this.graph0.append(\"rect\").attr(\"x\",x0+offset).attr(\"y\",y0+offset).attr(\"width\",0).attr(\"height\",0).attr(\"fill\",'#99ccff').attr(\"stroke\",'#0000dd').style('stroke-width',0.5).style('fill-opacity',0.3);}},{key:\"handleMouseMoveSvg\",value:function handleMouseMoveSvg(event){if(this.selectArea){event.preventDefault();event.stopPropagation();var _this$selectArea=this.selectArea,x0=_this$selectArea.x0,y0=_this$selectArea.y0;var _d3_pointer7=d3_pointer(event,this.graph0.node()),_d3_pointer8=_slicedToArray(_d3_pointer7,2),x1=_d3_pointer8[0],y1=_d3_pointer8[1];var x=Math.min(x0,x1);var y=Math.min(y0,y1);var width=Math.abs(x1-x0);var height=Math.abs(y1-y0);this.selectArea.selection.attr(\"x\",x).attr(\"y\",y).attr(\"width\",width).attr(\"height\",height);}}},{key:\"handleClickSvg\",value:function handleClickSvg(event){this.props.onFocus();document.activeElement.blur();if(event.which===1&&this.selectArea){event.preventDefault();event.stopPropagation();this.selectArea.selection.remove();var _this$selectArea2=this.selectArea,x0=_this$selectArea2.x0,y0=_this$selectArea2.y0;var _d3_pointer9=d3_pointer(event,this.graph0.node()),_d3_pointer10=_slicedToArray(_d3_pointer9,2),x1=_d3_pointer10[0],y1=_d3_pointer10[1];var x=Math.min(x0,x1);var y=Math.min(y0,y1);var width=Math.abs(x1-x0);var height=Math.abs(y1-y0);if(width===0&&height===0){this.selectArea=null;if(!(event.ctrlKey||event.shiftKey)){this.unSelectComponents();}return;}var components=this.graph0.selectAll('.node,.edge');components=components.filter(function(d,i){var bbox=this.getBBox();if(bbox.x<x||bbox.x+bbox.width>x+width)return false;if(bbox.y<y||bbox.y+bbox.height>y+height)return false;return true;});var extendSelection=event.ctrlKey||event.shiftKey;this.selectComponents(components,extendSelection);this.selectArea=null;}}},{key:\"handleMouseUpSvg\",value:function handleMouseUpSvg(event){this.props.onFocus();document.activeElement.blur();if(event.which===2){var _d3_pointer11=d3_pointer(event,this.graph0.node()),_d3_pointer12=_slicedToArray(_d3_pointer11,2),x0=_d3_pointer12[0],y0=_d3_pointer12[1];if(event.shiftKey){this.insertNodeWithDefaultAttributes(x0,y0,{shape:this.latestInsertedNodeShape});}else{this.insertNodeWithLatestAttributes(x0,y0);}}}},{key:\"selectAllComponents\",value:function selectAllComponents(){var components=this.graph0.selectAll('.node,.edge');this.selectComponents(components);}},{key:\"selectComponents\",value:function selectComponents(components){var _this4=this;var extendSelection=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(extendSelection){this.selectedComponents=d3_selectAll(this.selectedComponents.nodes().concat(components.nodes()));}else{this.unSelectComponents();this.selectedComponents=components;}this.markSelectedComponents(components,extendSelection);var selectedComponents=this.selectNames.map(function(name){return _this4.dotGraph.components[name];});this.props.onSelect(selectedComponents);}},{key:\"markSelectedComponents\",value:function markSelectedComponents(components){var extendSelection=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var scale=this.graph0.node().getCTM().a*3/4;var dashLength=Math.max(4/scale,2);var dashWidth=Math.max(4/scale,2);var rectNodes=[];var titles=[];var self=this;components.each(function(d,i){var component=d3_select(this);var color='black';var title=component.select('title').text();if(component.classed('edge')&&self.dotGraph.getEdgeAttributes(title)==null){color='red';}else{titles.push(title);}var bbox=component.node().getBBox();var rect=component.append(\"rect\").attr(\"x\",bbox.x).attr(\"y\",bbox.y).attr(\"width\",bbox.width).attr(\"height\",bbox.height).attr(\"stroke\",color).attr(\"fill\",\"transparent\").attr(\"opacity\",0.5).attr(\"stroke-dasharray\",dashLength).attr(\"stroke-width\",dashWidth);rectNodes.push(rect.node());});if(extendSelection){this.selectRects=d3_selectAll(this.selectRects.nodes().concat(rectNodes));this.selectNames=this.selectNames.concat(titles);}else{this.selectRects=d3_selectAll(rectNodes);this.selectNames=titles;}}},{key:\"unSelectComponents\",value:function unSelectComponents(){this.selectRects.remove();this.selectRects=d3_select(null);if(this.selectedComponents.size()>0){this.selectedComponents=d3_selectAll(null);this.props.onSelect([]);}}},{key:\"deleteSelectedComponents\",value:function deleteSelectedComponents(){this.selectedComponents.style(\"display\",\"none\");var self=this;this.selectedComponents.each(function(d,i){var component=d3_select(this);var componentName=component.selectWithoutDataPropagation(\"title\").text();if(component.attr('class')==='node'){self.dotGraph.deleteNode(componentName);}else{self.dotGraph.deleteEdge(componentName);}if(self.dotGraph.numDeletedComponents===0){component.style(\"display\",null);}if(i!==self.selectedComponents.size()-1){self.dotGraph.reparse();}});this.props.onTextChange(this.dotGraph.dotSrc);this.unSelectComponents();}},{key:\"getNextNodeId\",value:function getNextNodeId(){if(this.nodeIndex===null){this.nodeIndex=d3_select('#canvas').selectAll('.node').size();}else{this.nodeIndex+=1;}while(this.dotGraph.getNodeAttributes('n'+this.nodeIndex)){this.nodeIndex+=1;}return'n'+this.nodeIndex;}},{key:\"resizeSVG\",value:function resizeSVG(){var width=this.div.node().parentElement.clientWidth;var height=this.div.node().parentElement.clientHeight;var fit=this.props.fit;this.svg.attr(\"width\",width).attr(\"height\",height);if(!fit){this.unFitGraph();}}},{key:\"unFitGraph\",value:function unFitGraph(){var width=this.div.node().parentElement.clientWidth;var height=this.div.node().parentElement.clientHeight;this.svg.attr(\"viewBox\",\"0 0 \".concat(width*3/4,\" \").concat(height*3/4));}},{key:\"fitGraph\",value:function fitGraph(){this.svg.attr(\"viewBox\",\"0 0 \".concat(this.originalViewBox.width,\" \").concat(this.originalViewBox.height));}},{key:\"drawNode\",value:function drawNode(x0,y0,nodeName,attributes){this.graphviz.drawNode(x0,y0,nodeName,attributes);}},{key:\"updateAndInsertDrawnNode\",value:function updateAndInsertDrawnNode(x0,y0,attributes){var nodeName=this.drawnNodeName;attributes=Object.assign(this.latestNodeAttributes,attributes);this.graphviz.updateDrawnNode(x0,y0,nodeName,attributes);this.graphviz.insertDrawnNode(nodeName);this.dotGraph.insertNode(nodeName,attributes);this.props.onTextChange(this.dotGraph.dotSrc);}},{key:\"insertNode\",value:function insertNode(x0,y0,nodeName,attributes){this.drawNode(x0,y0,nodeName,attributes);this.graphviz.insertDrawnNode(nodeName);this.dotGraph.insertNode(nodeName,attributes);this.props.onTextChange(this.dotGraph.dotSrc);}},{key:\"drawNodeWithDefaultAttributes\",value:function drawNodeWithDefaultAttributes(x0,y0){var attributesToOverride=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};this.latestNodeAttributes=Object.assign({},this.props.defaultNodeAttributes);Object.assign(this.latestNodeAttributes,attributesToOverride);this.drawnNodeName=this.getNextNodeId();this.drawNode(x0,y0,this.drawnNodeName,this.latestNodeAttributes);}},{key:\"insertNodeWithLatestAttributes\",value:function insertNodeWithLatestAttributes(x0,y0){var attributesToOverride=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};if(x0==null||y0==null){var node=this.graph0.node();var bbox=node.getBBox();x0=x0||bbox.x+bbox.width/2;y0=y0||bbox.y+bbox.height/2;}Object.assign(this.latestNodeAttributes,attributesToOverride);var nodeName=this.getNextNodeId();this.insertNode(x0,y0,nodeName,this.latestNodeAttributes);}},{key:\"insertNodeWithDefaultAttributes\",value:function insertNodeWithDefaultAttributes(x0,y0){var attributesToOverride=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};this.latestNodeAttributes=Object.assign({},this.props.defaultNodeAttributes);this.insertNodeWithLatestAttributes(x0,y0,attributesToOverride);}},{key:\"render\",value:function render(){var _this5=this;var classes=this.props.classes;return React.createElement(React.Fragment,null,React.createElement(\"div\",{id:\"canvas\",ref:function ref(div){return _this5.div=d3_select(div);},onDragOver:this.handleNodeShapeDragOver,onDrop:this.handleNodeShapeDrop.bind(this)}),this.state.busy&&React.createElement(Fade,{in:true,style:{transitionDelay:'800ms'},unmountOnExit:true},React.createElement(CircularProgress,{id:\"busy-indicator\",className:classes.progress,color:\"secondary\",size:20,thickness:4.5})));}}]);return Graph;}(React.Component);export default withStyles(styles)(Graph);","map":{"version":3,"sources":["C:/Users/user/assisted-KAOS-editor/src/Graph.js"],"names":["React","withStyles","Fade","CircularProgress","select","d3_select","selectAll","d3_selectAll","transition","d3_transition","zoomIdentity","d3_zoomIdentity","zoomTransform","d3_zoomTransform","pointer","d3_pointer","DotGraph","wasmFolder","styles","root","flexGrow","flex","progress","position","top","left","isNumeric","n","isNaN","parseFloat","isFinite","Graph","props","getSvg","svg","node","handleZoomInButtonClick","scale","graphviz","zoomSelection","k","setZoomScale","handleZoomOutButtonClick","handleZoomOutMapButtonClick","viewBox","attr","split","bbox","graph0","getBBox","xRatio","width","yRatio","height","Math","min","handleZoomResetButtonClick","center","reset","x","y","x0","y0","scale0","xOffset0","yOffset0","xCenter","yCenter","xOffset","yOffset","transform","translate","call","zoomBehavior","handleNodeShapeClick","event","shape","onFocus","latestInsertedNodeShape","insertNodeWithDefaultAttributes","handleNodeShapeDragStart","outsideOfViewPort","drawNodeWithDefaultAttributes","drawnNodeSelection","empty","window","chrome","getCTM","a","dataTransfer","setDragImage","setData","handleNodeShapeDragOver","preventDefault","handleNodeShapeDrop","point","createSVGPoint","clientX","clientY","matrixTransform","getScreenCTM","inverse","updateAndInsertDrawnNode","handleNodeShapeDragEnd","removeDrawnNode","state","busy","createGraph","bind","renderGraph","isDrawingEdge","isDrawingNode","startNode","selectedComponents","selectArea","selectRects","latestNodeAttributes","latestEdgeAttributes","drawnNodeName","nodeIndex","edgeIndex","pendingUpdate","rendering","prevFit","prevEngine","prevDotSrc","errorMessage","line","replace","onError","message","setState","render","process","env","PUBLIC_URL","div","onerror","handleError","on","registerNodeShapeClick","registerNodeShapeDragStart","registerNodeShapeDragEnd","registerZoomInButtonClick","registerZoomOutButtonClick","registerZoomOutMapButtonClick","registerZoomResetButtonClick","registerGetSvg","parentElement","clientWidth","clientHeight","fit","engine","dotSrc","length","remove","renderGraphReady","unFitGraph","fitGraph","test","disableDotParsing","prelDotGraph","error","location","start","tweenPaths","tweenShapes","tweenPrecision","dot","handleDotLayoutReady","handleRenderStaged","handleRenderGraphReady","data","attributes","originalViewBox","markSelectedComponents","selectWithoutDataPropagation","dotGraph","addEventHandlers","duration","transitionDuration","onInitialized","self","filter","type","ctrlKey","nodes","edges","resizeSVG","handleClickDiv","document","handleKeyDownDocument","handleMouseMoveDiv","handleRightClickDiv","handleMouseDownSvg","handleMouseMoveSvg","handleClickSvg","handleMouseUpSvg","handleClickNode","handleDblClickNode","handleRightClickNode","handleClickEdge","activeElement","blur","stopPropagation","which","shiftKey","unSelectComponents","hasFocus","target","nodeName","key","removeDrawnEdge","deleteSelectedComponents","size","text","getNodeAttributes","insertNodeWithLatestAttributes","selectAllComponents","components","selectComponents","onUndo","onRedo","onHelp","penwidth","style","includes","shortening","moveDrawnEdgeEndPoint","extendSelection","currentTarget","endNode","startNodeName","endNodeName","insertDrawnEdge","Object","assign","defaultEdgeAttributes","insertEdge","onTextChange","id","drawEdge","offset","selection","append","x1","y1","abs","d","i","concat","selectNames","map","name","onSelect","dashLength","max","dashWidth","rectNodes","titles","each","component","color","title","classed","getEdgeAttributes","push","rect","componentName","deleteNode","deleteEdge","numDeletedComponents","reparse","drawNode","updateDrawnNode","insertDrawnNode","insertNode","attributesToOverride","defaultNodeAttributes","getNextNodeId","classes","transitionDelay","Component"],"mappings":"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","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { withStyles } from '@material-ui/core/styles';\r\nimport Fade from '@material-ui/core/Fade';\r\nimport CircularProgress from '@material-ui/core/CircularProgress';\r\nimport { select as d3_select} from 'd3-selection';\r\nimport { selectAll as d3_selectAll} from 'd3-selection';\r\nimport { transition as d3_transition} from 'd3-transition';\r\nimport { zoomIdentity as d3_zoomIdentity} from 'd3-zoom';\r\nimport { zoomTransform as d3_zoomTransform} from 'd3-zoom';\r\nimport { pointer as d3_pointer} from 'd3-selection';\r\nimport 'd3-graphviz';\r\nimport DotGraph from './dot'\r\nimport { wasmFolder } from \"@hpcc-js/wasm\";\r\n\r\nconst styles = {\r\n  root: {\r\n    flexGrow: 1,\r\n  },\r\n  flex: {\r\n    flexGrow: 1,\r\n  },\r\n  progress: {\r\n    position: 'absolute',\r\n    top: 'calc(64px + 2 * 12px + 2px)',\r\n    left: 'calc(100vw - 2 * 12px - 2 * 12px)',\r\n  },\r\n};\r\n\r\nfunction isNumeric(n) {\r\n    return !isNaN(parseFloat(n)) && isFinite(n);\r\n}\r\n\r\nclass Graph extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      busy: false,\r\n    };\r\n    this.svg = d3_select(null);\r\n    this.createGraph = this.createGraph.bind(this)\r\n    this.renderGraph = this.renderGraph.bind(this)\r\n    this.isDrawingEdge = false;\r\n    this.isDrawingNode = false;\r\n    this.startNode = null;\r\n    this.selectedComponents = d3_selectAll(null);\r\n    this.selectArea = null;\r\n    this.selectRects = d3_select(null);\r\n    this.latestNodeAttributes = {\r\n    }\r\n    this.latestEdgeAttributes = {\r\n    }\r\n    // latestInsertedNodeShape is not necessarily the same as\r\n    // latestNodeAttributes.shape with is also set on node copy\r\n    this.latestInsertedNodeShape = null;\r\n    this.drawnNodeName = null;\r\n    this.nodeIndex = null;\r\n    this.edgeIndex = null;\r\n    this.pendingUpdate = false;\r\n    this.rendering = false;\r\n    this.prevFit = null;\r\n    this.prevEngine = null;\r\n    this.prevDotSrc = '';\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.createGraph()\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    this.renderGraph()\r\n  }\r\n\r\n  handleError(errorMessage) {\r\n    let line = errorMessage.replace(/.*error in line ([0-9]*) .*\\n/, '$1');\r\n    this.props.onError({message: errorMessage, line: line});\r\n    this.rendering = false;\r\n    this.setState({busy: false});\r\n    if (this.pendingUpdate) {\r\n        this.pendingUpdate = false;\r\n        this.render();\r\n    }\r\n  }\r\n\r\n  getSvg = () => {\r\n    return this.svg.node();\r\n  }\r\n\r\n  createGraph() {\r\n    wasmFolder(process.env.PUBLIC_URL.replace(/\\.$/, '') + '@hpcc-js/wasm/dist');\r\n    this.graphviz = this.div.graphviz()\r\n      .onerror(this.handleError.bind(this))\r\n      .on('initEnd', () => this.renderGraph.call(this));\r\n    this.props.registerNodeShapeClick(this.handleNodeShapeClick);\r\n    this.props.registerNodeShapeDragStart(this.handleNodeShapeDragStart);\r\n    this.props.registerNodeShapeDragEnd(this.handleNodeShapeDragEnd);\r\n    this.props.registerZoomInButtonClick(this.handleZoomInButtonClick);\r\n    this.props.registerZoomOutButtonClick(this.handleZoomOutButtonClick);\r\n    this.props.registerZoomOutMapButtonClick(this.handleZoomOutMapButtonClick);\r\n    this.props.registerZoomResetButtonClick(this.handleZoomResetButtonClick);\r\n    this.props.registerGetSvg(this.getSvg);\r\n  }\r\n\r\n  renderGraph() {\r\n    let width = this.div.node().parentElement.clientWidth;\r\n    let height = this.div.node().parentElement.clientHeight;\r\n    let fit = this.props.fit;\r\n    let engine = this.props.engine;\r\n    if (this.props.dotSrc.length === 0) {\r\n      this.svg.remove();\r\n      this.svg = d3_select(null);\r\n      this.props.onError(null);\r\n      this.renderGraphReady = false;\r\n      return;\r\n    }\r\n    if (this.props.dotSrc === this.prevDotSrc && this.props.engine === this.prevEngine && this.props.fit === this.prevFit) {\r\n      return;\r\n    }\r\n    if (this.rendering) {\r\n        this.pendingUpdate = true;\r\n        return;\r\n    }\r\n    if (this.props.fit !== this.prevFit) {\r\n      if (this.renderGraphReady) {\r\n        if (this.prevFit) {\r\n          this.unFitGraph();\r\n          this.setZoomScale(1, true);\r\n        } else {\r\n          this.setZoomScale(1, false, true);\r\n          this.fitGraph();\r\n        }\r\n      }\r\n      this.prevFit = this.props.fit;\r\n    }\r\n    this.prevDotSrc = this.props.dotSrc;\r\n    this.prevEngine = this.props.engine;\r\n    try {\r\n      if (!this.props.test.disableDotParsing) {\r\n        this.prelDotGraph = new DotGraph(this.props.dotSrc);\r\n      }\r\n      this.props.onError(null);\r\n    }\r\n    catch(error) {\r\n      if (!error.location) {\r\n        throw error;\r\n      }\r\n      let {location: {start: {line}}, message} = error;\r\n      this.props.onError({message: message, line: line});\r\n      return;\r\n    }\r\n    this.rendering = true;\r\n    this.setState({busy: true});\r\n    this.graphviz\r\n      .width(width)\r\n      .height(height)\r\n      .engine(engine)\r\n      .fit(fit)\r\n      .tweenPaths(this.props.tweenPaths)\r\n      .tweenShapes(this.props.tweenShapes)\r\n      .tweenPrecision(this.props.tweenPrecision)\r\n      .dot(this.props.dotSrc, this.handleDotLayoutReady.bind(this))\r\n      .on('renderEnd', this.handleRenderStaged.bind(this))\r\n      .render(this.handleRenderGraphReady.bind(this));\r\n  }\r\n\r\n  handleDotLayoutReady() {\r\n    let [, , width, height] = this.graphviz.data().attributes.viewBox.split(' ');\r\n    this.originalViewBox = {width, height};\r\n  }\r\n\r\n  handleRenderStaged() {\r\n    if (this.renderGraphReady) {\r\n      this.markSelectedComponents(this.selectedComponents);\r\n    }\r\n  }\r\n\r\n  handleRenderGraphReady() {\r\n    this.svg = this.div.selectWithoutDataPropagation(\"svg\");\r\n    this.graph0 = this.svg.selectWithoutDataPropagation(\"g\");\r\n    this.dotGraph = this.prelDotGraph;\r\n    this.addEventHandlers();\r\n    this.rendering = false;\r\n    if (!this.renderGraphReady) {\r\n      this.renderGraphReady = true;\r\n      this.setZoomScale(1, true);\r\n      this.graphviz\r\n        .transition(() => d3_transition().duration(this.props.transitionDuration * 1000));\r\n      this.props.onInitialized();\r\n    }\r\n    this.setState({busy: false});\r\n    if (this.pendingUpdate) {\r\n      this.pendingUpdate = false;\r\n      this.renderGraph();\r\n    }\r\n  }\r\n\r\n  handleZoomInButtonClick = () => {\r\n    let scale = d3_zoomTransform(this.graphviz.zoomSelection().node()).k;\r\n    scale = scale * 1.2;\r\n    this.setZoomScale(scale);\r\n  }\r\n\r\n  handleZoomOutButtonClick = () => {\r\n    let scale = d3_zoomTransform(this.graphviz.zoomSelection().node()).k;\r\n    scale = scale / 1.2;\r\n    this.setZoomScale(scale);\r\n  }\r\n\r\n  handleZoomOutMapButtonClick = () => {\r\n    let viewBox = this.svg.attr(\"viewBox\").split(' ');\r\n    let bbox = this.graph0.node().getBBox();\r\n    let xRatio = viewBox[2] / bbox.width;\r\n    let yRatio = viewBox[3] / bbox.height;\r\n    let scale = Math.min(xRatio, yRatio);\r\n    this.setZoomScale(scale, true);\r\n  }\r\n\r\n  handleZoomResetButtonClick = () => {\r\n    this.setZoomScale(1, true);\r\n  }\r\n\r\n  setZoomScale = (scale, center=false, reset=false) => {\r\n    let viewBox = this.svg.attr(\"viewBox\").split(' ');\r\n    let bbox = this.graph0.node().getBBox();\r\n    let {x, y, k} = d3_zoomTransform(this.graphviz.zoomSelection().node());\r\n    let [x0, y0, scale0] = [x, y, k];\r\n    let xOffset0 = x0 + bbox.x * scale0;\r\n    let yOffset0 = y0 + bbox.y * scale0;\r\n    let xCenter = viewBox[2] / 2;\r\n    let yCenter = viewBox[3] / 2;\r\n    let xOffset;\r\n    let yOffset;\r\n    if (center) {\r\n      xOffset = (viewBox[2] - bbox.width * scale) / 2;\r\n      yOffset = (viewBox[3] - bbox.height * scale) / 2;\r\n    } else if (reset) {\r\n      xOffset = 0;\r\n      yOffset = 0;\r\n    } else {\r\n      xOffset = xCenter - (xCenter - xOffset0) * scale / scale0;\r\n      yOffset = yCenter - (yCenter - yOffset0) * scale / scale0;\r\n    }\r\n    x = -bbox.x * scale + xOffset;\r\n    y = -bbox.y * scale + yOffset;\r\n    let transform = d3_zoomIdentity.translate(x, y).scale(scale);\r\n    this.graphviz.zoomSelection().call(this.graphviz.zoomBehavior().transform, transform);\r\n  }\r\n\r\n  addEventHandlers() {\r\n\r\n    /*\r\n      Some empirical non-obvious and other relevant things to note:\r\n        1. Click events are preceeded by mousedown and mouseup events on the\r\n           same element.\r\n        2. 1st button clicks are click events on all elements.\r\n        3. 2nd and 3rd button clicks are click events on document and window\r\n           only, not on their children, although the event target is the child.\r\n        4. Keyboard events are dispatched on BODY, not on its children. This can\r\n           however be changed with the contenteditable attribute.\r\n    */\r\n\r\n    let self = this;\r\n    this.graphviz.zoomBehavior().filter(function (event) {\r\n      if (event.type === 'mousedown' && !event.ctrlKey) {\r\n        if (self.isDrawingEdge) {\r\n          return true;\r\n        } else {\r\n          return false;\r\n        }\r\n      } else {\r\n        return true;\r\n      }\r\n    });\r\n\r\n    var nodes = this.svg.selectAll(\".node\");\r\n    var edges = this.svg.selectAll(\".edge\");\r\n\r\n    d3_select(window).on(\"resize\", this.resizeSVG.bind(this));\r\n    this.div.on(\"click\", this.handleClickDiv.bind(this));\r\n    d3_select(document).on(\"keydown\", this.handleKeyDownDocument.bind(this));\r\n    this.div.on(\"mousemove\", this.handleMouseMoveDiv.bind(this));\r\n    this.div.on(\"contextmenu\", this.handleRightClickDiv.bind(this));\r\n    this.svg.on(\"mousedown\", this.handleMouseDownSvg.bind(this));\r\n    this.svg.on(\"mousemove\", this.handleMouseMoveSvg.bind(this));\r\n    this.svg.on(\"click\", this.handleClickSvg.bind(this));\r\n    this.svg.on(\"mouseup\", this.handleMouseUpSvg.bind(this));\r\n    nodes.on(\"click mousedown\", this.handleClickNode.bind(this));\r\n    nodes.on(\"dblclick\", this.handleDblClickNode.bind(this));\r\n    nodes.on(\"contextmenu\", this.handleRightClickNode.bind(this));\r\n    edges.on(\"click mousedown\", this.handleClickEdge.bind(this));\r\n\r\n  }\r\n\r\n  handleClickDiv(event) {\r\n    this.props.onFocus();\r\n    document.activeElement.blur();\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    if (!(event.which === 1 && (event.ctrlKey || event.shiftKey))) {\r\n      this.unSelectComponents();\r\n    }\r\n  }\r\n\r\n  handleKeyDownDocument(event) {\r\n    if (!this.props.hasFocus) {\r\n      return;\r\n    }\r\n    if (event.target.nodeName !== 'BODY') {\r\n      return;\r\n    }\r\n    if (event.key === 'Escape') {\r\n      this.graphviz.removeDrawnEdge();\r\n      this.unSelectComponents();\r\n    }\r\n    else if (event.key === 'Delete') {\r\n      this.deleteSelectedComponents.call(this);\r\n      this.graphviz.removeDrawnEdge();\r\n    }\r\n    else if (event.ctrlKey && event.key === 'c') {\r\n      let nodes = this.selectedComponents.filter('.node');\r\n      if (nodes.size() > 0) {\r\n          let nodeName = nodes.selectWithoutDataPropagation(\"title\").text();\r\n          this.latestNodeAttributes = this.dotGraph.getNodeAttributes(nodeName);\r\n      }\r\n    }\r\n    else if (event.ctrlKey && event.key === 'v') {\r\n      this.insertNodeWithLatestAttributes();\r\n    }\r\n    else if (event.ctrlKey && event.key === 'x') {\r\n      let nodes = this.selectedComponents.filter('.node');\r\n      if (nodes.size() > 0) {\r\n          let nodeName = nodes.selectWithoutDataPropagation(\"title\").text();\r\n          this.latestNodeAttributes = this.dotGraph.getNodeAttributes(nodeName);\r\n      }\r\n      this.deleteSelectedComponents.call(this);\r\n    }\r\n    else if (event.ctrlKey && event.key === 'a') {\r\n      this.selectAllComponents();\r\n    }\r\n    else if (event.ctrlKey && event.key === 'A') {\r\n      let components = this.graph0.selectAll('.edge');\r\n      this.selectComponents(components);\r\n    }\r\n    else if (event.ctrlKey && event.key === 'z') {\r\n      this.props.onUndo();\r\n    }\r\n    else if (event.ctrlKey && event.key === 'y') {\r\n      this.props.onRedo();\r\n    }\r\n    else if (event.key === '?') {\r\n      this.props.onHelp();\r\n    }\r\n    else {\r\n      return;\r\n    }\r\n    event.preventDefault();\r\n    this.isDrawingEdge = false;\r\n  }\r\n\r\n  handleMouseMoveDiv(event) {\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    var [x0, y0] = d3_pointer(event, this.graph0.node());\r\n    var penwidth = 1;\r\n    if (this.latestEdgeAttributes.penwidth != null) {\r\n      if (isNumeric(this.latestEdgeAttributes.penwidth)) {\r\n        penwidth = this.latestEdgeAttributes.penwidth;\r\n      }\r\n    } else if (this.latestEdgeAttributes.style && this.latestEdgeAttributes.style.includes('bold')) {\r\n      penwidth = 2;\r\n    }\r\n    var shortening = penwidth * 2; // avoid mouse pointing on edge\r\n\r\n    if (this.isDrawingEdge) {\r\n      this.graphviz\r\n        .moveDrawnEdgeEndPoint(x0, y0,  {shortening: shortening})\r\n    }\r\n  }\r\n\r\n  handleClickNode(event) {\r\n    this.props.onFocus();\r\n    document.activeElement.blur();\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    if (!this.isDrawingEdge && event.which === 1) {\r\n      let extendSelection = event.ctrlKey || event.shiftKey;\r\n      this.selectComponents(d3_select(event.currentTarget), extendSelection);\r\n    }\r\n  }\r\n\r\n  handleDblClickNode(event) {\r\n    this.props.onFocus();\r\n    document.activeElement.blur();\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    this.unSelectComponents();\r\n    if (this.isDrawingEdge) {\r\n      var endNode = d3_select(event.currentTarget);\r\n      var startNodeName = this.startNode.selectWithoutDataPropagation(\"title\").text();\r\n      var endNodeName = endNode.selectWithoutDataPropagation(\"title\").text();\r\n      this.graphviz\r\n        .insertDrawnEdge(startNodeName + '->' + endNodeName);\r\n      this.latestEdgeAttributes = Object.assign({}, this.props.defaultEdgeAttributes);\r\n      this.dotGraph.insertEdge(startNodeName, endNodeName, this.latestEdgeAttributes);\r\n      this.props.onTextChange(this.dotGraph.dotSrc);\r\n    }\r\n    this.isDrawingEdge = false;\r\n  }\r\n\r\n  handleRightClickNode(event) {\r\n    this.props.onFocus();\r\n    document.activeElement.blur();\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    this.unSelectComponents();\r\n    this.graphviz.removeDrawnEdge();\r\n    this.startNode = d3_select(event.currentTarget);\r\n    var [x0, y0] = d3_pointer(event, this.graph0.node());\r\n    if (this.edgeIndex === null) {\r\n      this.edgeIndex = d3_selectAll('.edge').size();\r\n    } else {\r\n      this.edgeIndex += 1;\r\n    }\r\n    this.latestEdgeAttributes = Object.assign({}, this.props.defaultEdgeAttributes);\r\n    this.latestEdgeAttributes.id = 'edge' + (this.edgeIndex + 1);\r\n\r\n    this.graphviz\r\n      .drawEdge(x0, y0, x0, y0, this.latestEdgeAttributes);\r\n    this.isDrawingEdge = true;\r\n  }\r\n\r\n  handleClickEdge(event) {\r\n    this.props.onFocus();\r\n    document.activeElement.blur();\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    let extendSelection = event.ctrlKey || event.shiftKey;\r\n    this.selectComponents(d3_select(event.currentTarget), extendSelection);\r\n  }\r\n\r\n  handleRightClickDiv(event) {\r\n    this.props.onFocus();\r\n    document.activeElement.blur();\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    this.unSelectComponents();\r\n  }\r\n\r\n  handleMouseDownSvg(event) {\r\n    this.props.onFocus();\r\n    document.activeElement.blur();\r\n    if (event.which !== 1) {\r\n      return;\r\n    }\r\n    event.preventDefault();\r\n    event.stopPropagation();\r\n    if (this.selectArea) {\r\n      return;\r\n    }\r\n    var [x0, y0] = d3_pointer(event, this.graph0.node());\r\n    this.selectArea = {x0: x0, y0: y0};\r\n    let offset = 1;  // avoid covering the svg at click in Chrome\r\n    this.selectArea.selection = this.graph0.append(\"rect\")\r\n      .attr(\"x\", x0 + offset)\r\n      .attr(\"y\", y0 + offset)\r\n      .attr(\"width\", 0)\r\n      .attr(\"height\", 0)\r\n      .attr(\"fill\", '#99ccff')\r\n      .attr(\"stroke\", '#0000dd')\r\n      .style('stroke-width', 0.5)\r\n      .style('fill-opacity', 0.3);\r\n  }\r\n\r\n  handleMouseMoveSvg(event) {\r\n    if (this.selectArea) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      let {x0, y0} = this.selectArea;\r\n      var [x1, y1] = d3_pointer(event, this.graph0.node());\r\n      let x = Math.min(x0, x1);\r\n      let y = Math.min(y0, y1);\r\n      let width = Math.abs(x1 - x0);\r\n      let height = Math.abs(y1 - y0);\r\n      this.selectArea.selection\r\n        .attr(\"x\", x)\r\n        .attr(\"y\", y)\r\n        .attr(\"width\", width)\r\n        .attr(\"height\", height);\r\n    }\r\n  }\r\n\r\n  handleClickSvg(event) {\r\n    this.props.onFocus();\r\n    document.activeElement.blur();\r\n    if (event.which === 1 && this.selectArea) {\r\n      event.preventDefault();\r\n      event.stopPropagation();\r\n      this.selectArea.selection.remove();\r\n      let {x0, y0} = this.selectArea;\r\n      var [x1, y1] = d3_pointer(event, this.graph0.node());\r\n      let x = Math.min(x0, x1);\r\n      let y = Math.min(y0, y1);\r\n      let width = Math.abs(x1 - x0);\r\n      let height = Math.abs(y1 - y0);\r\n      if (width === 0 && height === 0) {\r\n        this.selectArea = null;\r\n        if (!(event.ctrlKey || event.shiftKey)) {\r\n          this.unSelectComponents();\r\n        }\r\n        return;\r\n      }\r\n      let components = this.graph0.selectAll('.node,.edge');\r\n      components = components.filter(function(d, i) {\r\n        let bbox = this.getBBox();\r\n        if (bbox.x < x || bbox.x + bbox.width > x + width)\r\n          return false\r\n        if (bbox.y < y || bbox.y + bbox.height > y + height)\r\n          return false\r\n        return true\r\n      });\r\n      let extendSelection = event.ctrlKey || event.shiftKey;\r\n      this.selectComponents(components, extendSelection);\r\n      this.selectArea = null;\r\n    }\r\n  }\r\n\r\n  handleMouseUpSvg(event) {\r\n    this.props.onFocus();\r\n    document.activeElement.blur();\r\n    if (event.which === 2) {\r\n      var [x0, y0] = d3_pointer(event, this.graph0.node());\r\n      if (event.shiftKey) {\r\n        this.insertNodeWithDefaultAttributes(x0, y0, {shape: this.latestInsertedNodeShape});\r\n      } else {\r\n        this.insertNodeWithLatestAttributes(x0, y0);\r\n      }\r\n    }\r\n  }\r\n\r\n  selectAllComponents() {\r\n    let components = this.graph0.selectAll('.node,.edge');\r\n    this.selectComponents(components);\r\n  }\r\n\r\n  selectComponents(components, extendSelection=false) {\r\n    if (extendSelection) {\r\n      this.selectedComponents = d3_selectAll(this.selectedComponents.nodes().concat(components.nodes()));\r\n    } else {\r\n      this.unSelectComponents();\r\n      this.selectedComponents = components;\r\n    }\r\n    this.markSelectedComponents(components, extendSelection);\r\n    const selectedComponents = this.selectNames.map((name) => this.dotGraph.components[name]);\r\n    this.props.onSelect(selectedComponents);\r\n  }\r\n\r\n  markSelectedComponents(components, extendSelection=false) {\r\n    let scale = this.graph0.node().getCTM().a * 3 / 4;\r\n    let dashLength = Math.max(4 / scale, 2);\r\n    let dashWidth = Math.max(4 / scale, 2);\r\n    let rectNodes = [];\r\n    let titles = [];\r\n    const self = this;\r\n    components.each(function(d, i) {\r\n      let component = d3_select(this);\r\n      let color = 'black';\r\n      const title = component.select('title').text();\r\n      if (component.classed('edge') && self.dotGraph.getEdgeAttributes(title) == null) {\r\n        color = 'red';\r\n      } else {\r\n        titles.push(title);\r\n      }\r\n      let bbox = component.node().getBBox();\r\n      let rect = component.append(\"rect\")\r\n        .attr(\"x\", bbox.x)\r\n        .attr(\"y\", bbox.y)\r\n        .attr(\"width\", bbox.width)\r\n        .attr(\"height\", bbox.height)\r\n        .attr(\"stroke\", color)\r\n        .attr(\"fill\", \"transparent\")\r\n        .attr(\"opacity\", 0.5)\r\n        .attr(\"stroke-dasharray\", dashLength)\r\n        .attr(\"stroke-width\",  dashWidth);\r\n      rectNodes.push(rect.node());\r\n    });\r\n    if (extendSelection) {\r\n      this.selectRects = d3_selectAll(this.selectRects.nodes().concat(rectNodes));\r\n      this.selectNames = this.selectNames.concat(titles);\r\n    } else {\r\n      this.selectRects = d3_selectAll(rectNodes);\r\n      this.selectNames = titles;\r\n    }\r\n  }\r\n\r\n  unSelectComponents() {\r\n    this.selectRects.remove();\r\n    this.selectRects = d3_select(null);\r\n    if (this.selectedComponents.size() > 0) {\r\n      this.selectedComponents = d3_selectAll(null);\r\n      this.props.onSelect([]);\r\n    }\r\n  }\r\n\r\n  deleteSelectedComponents() {\r\n    this.selectedComponents.style(\"display\", \"none\");\r\n    let self = this;\r\n    this.selectedComponents.each(function(d, i) {\r\n      let component = d3_select(this);\r\n      var componentName = component.selectWithoutDataPropagation(\"title\").text();\r\n      if (component.attr('class') === 'node') {\r\n        self.dotGraph.deleteNode(componentName);\r\n      } else {\r\n        self.dotGraph.deleteEdge(componentName);\r\n      }\r\n      if (self.dotGraph.numDeletedComponents === 0) {\r\n        component.style(\"display\", null);\r\n      }\r\n      if (i !== self.selectedComponents.size() - 1) {\r\n        self.dotGraph.reparse();\r\n      }\r\n    });\r\n    this.props.onTextChange(this.dotGraph.dotSrc);\r\n    this.unSelectComponents();\r\n  }\r\n\r\n  getNextNodeId() {\r\n    if (this.nodeIndex === null) {\r\n      this.nodeIndex = d3_select('#canvas').selectAll('.node').size();\r\n    } else {\r\n      this.nodeIndex += 1;\r\n    }\r\n    while (this.dotGraph.getNodeAttributes('n' + this.nodeIndex)) {\r\n      this.nodeIndex += 1;\r\n    }\r\n    return 'n' + this.nodeIndex;\r\n  }\r\n\r\n  resizeSVG() {\r\n    let width = this.div.node().parentElement.clientWidth;\r\n    let height = this.div.node().parentElement.clientHeight;\r\n    let fit = this.props.fit;\r\n\r\n    this.svg\r\n      .attr(\"width\", width)\r\n      .attr(\"height\", height);\r\n    if (!fit) {\r\n      this.unFitGraph();\r\n    }\r\n  };\r\n\r\n  unFitGraph() {\r\n    let width = this.div.node().parentElement.clientWidth;\r\n    let height = this.div.node().parentElement.clientHeight;\r\n    this.svg\r\n      .attr(\"viewBox\", `0 0 ${width * 3 / 4} ${height * 3 / 4}`);\r\n  }\r\n\r\n  fitGraph() {\r\n    this.svg\r\n      .attr(\"viewBox\", `0 0 ${this.originalViewBox.width} ${this.originalViewBox.height}`);\r\n  }\r\n\r\n  handleNodeShapeClick = (event, shape) => {\r\n    if (shape === '(default)') {\r\n      shape = null;\r\n    }\r\n    this.props.onFocus();\r\n    let x0 = null;\r\n    let y0 = null;\r\n    this.latestInsertedNodeShape = shape;\r\n    this.insertNodeWithDefaultAttributes(x0, y0, {shape: shape});\r\n  }\r\n\r\n  handleNodeShapeDragStart = (event, shape) => {\r\n    if (shape === '(default)') {\r\n      shape = null;\r\n    }\r\n    let outsideOfViewPort = 1000000;\r\n    this.latestInsertedNodeShape = shape;\r\n    this.drawNodeWithDefaultAttributes(outsideOfViewPort, outsideOfViewPort, {shape: shape});\r\n    let node = this.graphviz.drawnNodeSelection();\r\n    if (!node.empty() && !window.chrome) {\r\n      let bbox = node.node().getBBox();\r\n      let scale = node.node().getCTM().a;\r\n      node.attr(\"transform\", `scale(${scale})`);\r\n      event.dataTransfer.setDragImage(node.node(), bbox.width / 2 * scale * 4 / 3, bbox.height / 2 * scale * 4 / 3);\r\n    }\r\n    event.dataTransfer.setData(\"text\", shape)\r\n  }\r\n\r\n  handleNodeShapeDragOver = (event) => {\r\n    event.preventDefault();\r\n  };\r\n\r\n  handleNodeShapeDrop = (event) => {\r\n    this.props.onFocus();\r\n    event.preventDefault();\r\n    this.graphviz.drawnNodeSelection().attr(\"transform\", null);\r\n    let node = this.graph0.node();\r\n    var point = this.svg.node().createSVGPoint();\r\n    point.x = event.clientX;\r\n    point.y = event.clientY;\r\n    point = point.matrixTransform(node.getScreenCTM().inverse());\r\n    var [x0, y0] = [point.x, point.y];\r\n    this.updateAndInsertDrawnNode(x0, y0, {});\r\n  }\r\n\r\n  handleNodeShapeDragEnd = (event, shape) => {\r\n    this.graphviz.removeDrawnNode();\r\n  }\r\n\r\n  drawNode(x0, y0, nodeName, attributes) {\r\n    this.graphviz.drawNode(x0, y0, nodeName, attributes);\r\n  };\r\n\r\n  updateAndInsertDrawnNode(x0, y0, attributes) {\r\n    let nodeName = this.drawnNodeName;\r\n    attributes = Object.assign(this.latestNodeAttributes, attributes);\r\n    this.graphviz.updateDrawnNode(x0, y0, nodeName, attributes);\r\n    this.graphviz.insertDrawnNode(nodeName);\r\n    this.dotGraph.insertNode(nodeName, attributes);\r\n    this.props.onTextChange(this.dotGraph.dotSrc);\r\n  };\r\n\r\n  insertNode(x0, y0, nodeName, attributes) {\r\n    this.drawNode(x0, y0, nodeName, attributes);\r\n    this.graphviz.insertDrawnNode(nodeName);\r\n    this.dotGraph.insertNode(nodeName, attributes);\r\n    this.props.onTextChange(this.dotGraph.dotSrc);\r\n  };\r\n\r\n  drawNodeWithDefaultAttributes(x0, y0, attributesToOverride={}) {\r\n    this.latestNodeAttributes = Object.assign({}, this.props.defaultNodeAttributes);\r\n    Object.assign(this.latestNodeAttributes, attributesToOverride);\r\n    this.drawnNodeName = this.getNextNodeId();\r\n    this.drawNode(x0, y0, this.drawnNodeName, this.latestNodeAttributes);\r\n  }\r\n\r\n  insertNodeWithLatestAttributes(x0, y0, attributesToOverride={}) {\r\n    if (x0 == null || y0 == null) {\r\n      let node = this.graph0.node();\r\n      let bbox = node.getBBox();\r\n      x0 = x0 || bbox.x + bbox.width / 2;\r\n      y0 = y0 || bbox.y + bbox.height / 2;\r\n    }\r\n    Object.assign(this.latestNodeAttributes, attributesToOverride);\r\n    let nodeName = this.getNextNodeId();\r\n    this.insertNode(x0, y0, nodeName, this.latestNodeAttributes);\r\n  }\r\n\r\n  insertNodeWithDefaultAttributes(x0, y0, attributesToOverride={}) {\r\n    this.latestNodeAttributes = Object.assign({}, this.props.defaultNodeAttributes);\r\n    this.insertNodeWithLatestAttributes(x0, y0, attributesToOverride);\r\n  }\r\n\r\n  render() {\r\n    const { classes } = this.props;\r\n    return (\r\n      <React.Fragment>\r\n        <div\r\n          id=\"canvas\"\r\n          ref={div => this.div = d3_select(div)}\r\n          onDragOver={this.handleNodeShapeDragOver}\r\n          onDrop={this.handleNodeShapeDrop.bind(this)}\r\n        >\r\n        </div>\r\n        {this.state.busy && (\r\n          <Fade\r\n            in={true}\r\n            style={{\r\n              transitionDelay: '800ms',\r\n            }}\r\n            unmountOnExit\r\n          >\r\n             <CircularProgress\r\n               id=\"busy-indicator\"\r\n               className={classes.progress}\r\n               color=\"secondary\"\r\n               size={20}\r\n               thickness={4.5}\r\n             />\r\n          </Fade>\r\n        )}\r\n      </React.Fragment>\r\n    );\r\n  }\r\n}\r\n\r\nGraph.propTypes = {\r\n  classes: PropTypes.object.isRequired,\r\n};\r\n\r\nexport default withStyles(styles)(Graph);\r\n"]},"metadata":{},"sourceType":"module"}